{% extends 'base.html' %}

{% block subtitle %}
{% trans %} Customize {% endtrans %}
{% endblock subtitle %}

{% block header_content %}
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>

<style>
    #gcb-nav-y ul li:hover {
        background-color: rgba(139, 148, 155, 0.17);
        font-weight: bold;
    }
</style>

<script>

$(document).ready(function(){
    $('#droppedItems').on('click', '.removeButton', function(){
        $(this).closest ('tr').remove ();
    });

    $( "#gcb-nav-y" ).accordion();

    $("#gcb-nav-y li").draggable({
        appendTo: "body",
        helper: "clone"
    });

    $("#droppedItems").droppable({
        activeClass:"ui-state-default",
        hoverClass:"ui-state-hover",
        accept:":not(.ui-sortable-helper)",
        drop: function(event, ui) {
            var a = ui.draggable.find('a').text();
            var href = ui.draggable.find('a').attr('href');
            var unit = ui.draggable.find('input[name="unit"]').attr('value');
            var lesson = ui.draggable.find('input[name="lesson"]').attr('value');

            var lessonFind = $("#dropTable").find('[name="lesson"][value="'+ unit + '.' + lesson +'"]');

            var tr = $('<tr></tr>').append($('<td></td>').append($('<a></a>').text(a).attr('href', href))).
                    append($('<td></td>').append($('<a></a>').attr('type', 'button').addClass('removeButton').text('Remove')).
                            append($('<input>').attr('type', 'hidden').attr('name', 'lesson').attr('value', unit + "." + lesson)));

            if (lessonFind.length == 0) {
                $( "#droppedItems tbody" ).append(tr);
            }
        }
    });

    $("#droppedItems tbody").sortable();

    $('#submitForm').submit(function() {
        var count = 0;
        $('#dropTable > tbody  > tr').each(function() {
            $(this).find('input[name="lesson"]').attr('name', 'lesson.' + count);
            count++;
        });

        $('#total').attr('value', count);
    });

    $('#save').click(function() {
        $('#submitForm').submit();
    });

    $('#clear').click(function() {
        $('#dropTable > tbody  > tr').each(function() {
            $(this).remove();
        });
    });
});



</script>
{% endblock %}

{% block top_content %}
{% endblock %}

{% block main_content %}

<div class="gcb-main">
    <div>
        <h3 class="class_header">
            Customize the lesson order
        </h3>
    </div>

    <div style="width: 25%;" class="gcb-nav" id="gcb-nav-y">
        {% for unit in units %}
        {% if unit.type != 'A' and unit.type != 'O' %}
            <h3>{{ unit.unit_id }}. {{ unit.title }}</h3>
            <div>
            {% if units_lessons[unit.unit_id] != 'None' %}
                <ul>
                    {% for v in units_lessons[unit.unit_id] %}
                    <li style="border-bottom: none;">
                        <a href="unit?unit={{unit.unit_id}}&lesson={{v.lesson_id}}">{{ unit.unit_id }}.{{v.lesson_id}}. {{v.title}}</a>
                        <input type='hidden' name='unit' value="{{unit.unit_id}}">
                        <input type='hidden' name='lesson' value="{{v.lesson_id}}">
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
            </div>
        {% endif %}
        {% endfor %}
    </div>

    <div class="gcb-article tab-content" style="width: 70%;" role="main">
        <form method="post" action="playlist">
            <div >
                <div id="submitForm">
                    <table>
                        <tbody>
                            <tr>
                                <td><input id='save' type='submit' value="Save" style='margin: 5px 20px 5px 5px;padding: 2px 10px 2px 10px' ><input type='button' id='clear' value="Clear" style='margin: 5px 20px 5px 5px;padding: 2px 10px 2px 10px'></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div>
                <div id="droppedItems" style='height: 100%'>
                    <table class="tftable" id='dropTable'>
                        <thead>
                            <tr >
                                <td style="width: 100%">Drag and Drop lessons here</td>
                                <td>Action</td>
                            </tr>
                        </thead>
                        <tbody>
                        {% if playList != 'None' %}

                        {% for p in playList %}
                            {% for v in units_lessons[p['unit']] %}
                                {% if v.lesson_id == p['lesson'] %}
                                    <tr>
                                        <td><a href="playlist">{{p['unit']}}.{{p['lesson']}} {{v.title}}</a></td>
                                        <td>
                                            <a type='button' class='removeButton'>Remove</a>
                                            <input type="hidden" value="{{p['unit']}}.{{p['lesson']}}" name="lesson">
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                        {% endif %}
                        </tbody>
                    </table>
                    <input type="hidden" value='{{total}}' name='total' id='total'>
                </div>
            </div>
        </form>
    </div>
</div>

{% endblock %}